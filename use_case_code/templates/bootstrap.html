<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="{{ refresh }}" >

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  </head>
  <body>
  <!-- Head Bar -->
    <nav class="navbar navbar-light bg-light fixed top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="https://upload.wikimedia.org/wikipedia/commons/7/76/20150501_HSD_Logo_rot_transparent.png" alt="" width="100" height="50"
               class="d-inline-block align-text-center m-3">
          Earthquake Detector
        </a>
      </div>
    </nav>
  <!-- Parameter Search -->
  <br />
  <form>
    <label for="location" style="margin-left:1.4em;" class="form-label"><b>Search for earthquakes by providing a city name or the coordinates of your destination.</b></label>
        <div class="input-group mb-3 w-75 m-4">
            <span class="input-group-text" id="basic-addon3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
            </svg></span>
            <input type="text" class="form-control" id="location" name="location" value="{{ location }}">
        </div>
            <br />
        <div>
            <label for="radius" style="margin-left:1.4em;margin-right:1.4em;"><b>Specify the radius for your earthquakes search</b> (in km).
            </label>
                <input type="range" name="radius" id="radius" min="100" max="1000" step="50" value="{{ radius }}" oninput="this.nextElementSibling.value = this.value">
                <output>{{ radius }} km.</output>
            <button class="btn btn-outline-danger btn-sm" type="button" onclick="disableRange()">Disable</button>
            <p id="radiusDisabled" style="margin-left:1.4em;margin-right:1.4em;"></p>
            <script>
               function disableRange() {
                  document.getElementById("radius").disabled=true;
                  document.getElementById("radiusDisabled").innerHTML = "Radius is now disabled." ;
               }
            </script>
        </div>
            <br />
        <div>
            <label for="refresh" style="margin-left:1.4em;margin-right:1.4em;"><b>Specify the update frequency</b> (in seconds).
            </label>
                <input type="range" name="refresh" id="refresh" min="10" max="300" step="10" value="{{ refresh }}" oninput="this.nextElementSibling.value = this.value">
                <output>{{ refresh }} seconds.</output>
            <button class="btn btn-outline-danger btn-sm" type="button" onclick="disableRange()">Disable</button>
            <p id="refreshDisabled" style="margin-left:1.4em;margin-right:1.4em;"></p>
            <script>
               function disableRange() {
                  document.getElementById("refresh").disabled=true;
                  document.getElementById("refreshDisabled").innerHTML = "The page refresh function is now disabled." ;
               }
            </script>
        </div>
            <br />
        <input class="btn btn-outline-danger p-1.5 m-4" type="submit" value="Submit">
  </form>

  <!-- Time on Site -->
  <p id="lastRefresh" style="margin-left:1.4em;margin-right:1.4em;">Last page update: Wait.....</p>

  <script>
    function setTime(){
      var date = new Date();
      timestamp = date.getTime();
    }

    //Call setTime when you make initial call
    setTime();

    //Set the delay here in ms
    var updateDelay = 1000;

    var lastRefresh = document.getElementById("lastRefresh");

    function updateLastRefreshTime() {
      var currentDate = new Date();
      var currentTime = currentDate.getTime();
      var timeSince = Math.floor((currentTime - timestamp)/1000);
      let timeStampDescription = "";

      // year
      if(timeSince > 31536000){;
        timeStampDescription = "Last page update: " + Math.floor(timeSince/31536000) + " year(s) ago."
      // Days
      } else if(timeSince > 86400){
        timeStampDescription = "Last page update: " + Math.floor(timeSince/86400) + " day(s) ago."
      // Hours
      } else if(timeSince > 3600){
        timeStampDescription = "Last page update: " + Math.floor(timeSince/3600) + " hour(s) ago."
      // Minutes
      } else if(timeSince > 60) {
        timeStampDescription = "Last page update: " + Math.floor(timeSince/60) + " minute(s) ago."
      // Seconds
      } else{
        timeStampDescription = "Last page update: " + timeSince + " seconds ago."
      }
      lastRefresh.innerText = timeStampDescription;
     }
     setInterval(updateLastRefreshTime, updateDelay);
 </script>
  <!-- Map Integration -->
    <iframe class="map", src="/map" width=100% height="500" style="border:1px solid grey;"></iframe>
  </body>
</html>